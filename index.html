<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>KREASYS | Autonomous Multi-IDE</title>
    <meta name="description"
        content="100% browser-native 24/7 autonomous bot with VFS IDE, Self-Modifying Memory, and Webhooks." />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class', theme: { extend: { colors: { ks: { bg: '#050510', bglit: '#0b0b1a', bd: '#1a1a3a', ac: '#00ffcc', ac2: '#00b3ff', txt: '#e0e0f0', dim: '#6a6a8a', err: '#ff4a4a', ok: '#39ff14', war: '#ffcc00' } } } } }</script>
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#030308">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <input type="file" id="up-sys" style="display:none" onchange="upFile(event,'sys')">
    <input type="file" id="up-wrk" style="display:none" onchange="upFile(event,'wrk')">

    <nav>
        <div class="brand">KREASYS</div>
        <div class="nav-tab active" data-target="p-chat"><i data-lucide="message-square"></i> Chat</div>
        <div class="nav-tab" data-target="p-ide"><i data-lucide="code-2"></i> Workspace</div>
        <div class="nav-tab" data-target="p-id"><i data-lucide="brain-circuit"></i> Core Data</div>
        <div class="nav-tab" data-target="p-mod"><i data-lucide="network"></i> Models</div>
        <div class="nav-tab" data-target="p-wllm"><i data-lucide="cpu"></i> Local AI</div>
        <div class="nav-tab" data-target="p-term"><i data-lucide="activity"></i> SysLog</div>
        <div class="nav-tab" data-target="p-cfg"><i data-lucide="webhook"></i> Integrations</div>
        <button class="btn primary" id="btn-install" onclick="deferredInstallPrompt&&deferredInstallPrompt.prompt()"
            style="display:none;padding:6px 14px;font-size:12px;height:32px;border-radius:8px"><i
                data-lucide="download"></i> Install App</button>
        <div style="flex:1"></div>
        <div class="stat-pill"><span class="dot dim" id="st-tg"></span> TG</div>
        <div class="stat-pill"><span class="dot dim" id="st-db"></span> DB</div>
        <div class="stat-pill" style="display:none" id="st-ram-w"><span id="st-ram">0MB</span></div>
    </nav>

    <div class="main-area">

        <div id="p-chat" class="panel active" style="padding:0;background:transparent;">
            <div style="flex:1;overflow-y:auto;display:flex;flex-direction:column;padding:20px;gap:16px" id="c-log">
            </div>
            <div
                style="padding:20px;display:flex;flex-direction:column;justify-content:center;background:var(--glass-bg);backdrop-filter:var(--glass-blur);-webkit-backdrop-filter:var(--glass-blur);border-top:1px solid rgba(255,255,255,0.05);box-shadow:0 -10px 40px rgba(0,0,0,0.2);position:relative;z-index:10;">
                <input type="file" id="chat-file-in" style="display:none"
                    accept="image/*,text/*,.md,.js,.py,.json,.html,.css,.ts,.jsx,.csv,.xml,.yaml,.yml">
                <div style="max-width:850px;width:100%;margin:0 auto;display:flex;gap:12px;align-items:flex-end">
                    <button class="btn" id="btn-attach"
                        style="height:50px;width:50px;flex-shrink:0;padding:0;border-radius:12px;"
                        title="Attach file"><i data-lucide="paperclip"></i></button>
                    <textarea id="c-in" rows="1"
                        placeholder="Chat with KREASYS... Attach files or ask for images, audio, code!"
                        style="font-size:14px;padding:14px 16px;border-radius:12px;box-shadow:inset 0 2px 5px rgba(0,0,0,0.2)"></textarea>
                    <button class="btn primary" id="btn-run-c"
                        style="height:50px;width:56px;flex-shrink:0;padding:0;border-radius:12px;"><i
                            data-lucide="send"></i></button>
                    <button class="btn err" id="btn-stop-c"
                        style="display:none;height:50px;width:56px;flex-shrink:0;padding:0;border-radius:12px;"><i
                            data-lucide="square"></i></button>
                </div>
            </div>
        </div>

        <div id="p-ide" class="panel" style="overflow:hidden;padding:0;background:transparent;">
            <div class="vfs-grid" style="width:100%">
                <div
                    style="height:100%;overflow-y:auto;background:var(--glass-bg);backdrop-filter:var(--glass-blur);-webkit-backdrop-filter:var(--glass-blur);border:1px solid rgba(255,255,255,0.05);border-radius:12px;display:flex;flex-direction:column;box-shadow:var(--shadow)">
                    <div
                        style="padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:space-between">
                        <div
                            style="font-size:13px;font-weight:600;color:var(--txt);letter-spacing:1px;text-transform:uppercase;">
                            <i data-lucide="folder-tree"
                                style="width:14px;display:inline-block;margin-right:6px;color:var(--ac)"></i>
                            /workspace/
                        </div>
                    </div>
                    <div id="vfs-tree-wrk"
                        style="flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:4px;font-size:13px">
                    </div>
                    <div
                        style="padding:16px;border-top:1px solid rgba(255,255,255,0.05);display:flex;flex-direction:column;gap:10px">
                        <div style="display:flex;gap:10px">
                            <button class="btn" style="flex:1;padding:10px" onclick="nwFile('wrk')"><i
                                    data-lucide="file-plus"></i></button>
                            <button class="btn" style="flex:1;padding:10px" onclick="$('#up-wrk').click()"><i
                                    data-lucide="upload"></i></button>
                        </div>
                        <button class="btn primary" onclick="dlZip('wrk')"><i data-lucide="file-archive"></i> Export
                            ZIP</button>
                        <button class="btn err" onclick="wipeWrk()"><i data-lucide="flame"></i> Format Drive</button>
                    </div>
                </div>
                <div
                    style="height:100%;display:flex;flex-direction:column;background:var(--glass-bg);backdrop-filter:var(--glass-blur);-webkit-backdrop-filter:var(--glass-blur);border:1px solid rgba(255,255,255,0.05);border-radius:12px;box-shadow:var(--shadow);overflow:hidden">
                    <div
                        style="padding:12px 20px;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;gap:12px;background:rgba(0,0,0,0.2)">
                        <i data-lucide="file-code" style="color:var(--ac);width:16px"></i>
                        <span id="vfs-fn-wrk" style="font-size:14px;font-weight:500;color:var(--txt)">No File
                            Selected</span>
                        <div style="flex:1"></div>
                        <button class="btn okc" style="padding:8px 14px;font-size:12px" onclick="ideSave('wrk')"><i
                                data-lucide="save"></i> Save File</button>
                    </div>
                    <textarea id="vfs-ed-wrk"
                        style="flex:1;resize:none;font-size:14px;font-family:var(--font-mono);line-height:1.6;padding:20px;border:none;border-radius:0;background:transparent;backdrop-filter:none;"
                        spellcheck="false" placeholder="Select a workspace project file or upload one..."></textarea>
                </div>
            </div>
        </div>

        <div id="p-id" class="panel" style="overflow:hidden;padding:0;background:transparent;">
            <div class="vfs-grid" style="width:100%">
                <div
                    style="height:100%;overflow-y:auto;background:var(--glass-bg);backdrop-filter:var(--glass-blur);-webkit-backdrop-filter:var(--glass-blur);border:1px solid rgba(255,255,255,0.05);border-radius:12px;display:flex;flex-direction:column;box-shadow:var(--shadow)">
                    <div
                        style="padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:space-between">
                        <div
                            style="font-size:13px;font-weight:600;color:var(--txt);letter-spacing:1px;text-transform:uppercase;">
                            <i data-lucide="brain-circuit"
                                style="width:14px;display:inline-block;margin-right:6px;color:var(--ac)"></i> /system/
                        </div>
                    </div>
                    <div id="vfs-tree-sys"
                        style="flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:4px;font-size:13px">
                    </div>
                    <div
                        style="padding:16px;border-top:1px solid rgba(255,255,255,0.05);display:flex;flex-direction:column;gap:10px">
                        <div style="display:flex;gap:10px">
                            <button class="btn" style="flex:1;padding:10px" onclick="nwFile('sys')"><i
                                    data-lucide="file-plus"></i></button>
                            <button class="btn" style="flex:1;padding:10px" onclick="$('#up-sys').click()"><i
                                    data-lucide="upload"></i></button>
                        </div>
                        <button class="btn primary" onclick="dlZip('sys')"><i data-lucide="file-archive"></i> Backup
                            Core</button>
                    </div>
                </div>
                <div
                    style="height:100%;display:flex;flex-direction:column;background:var(--glass-bg);backdrop-filter:var(--glass-blur);-webkit-backdrop-filter:var(--glass-blur);border:1px solid rgba(255,255,255,0.05);border-radius:12px;box-shadow:var(--shadow);overflow:hidden">
                    <div
                        style="padding:12px 20px;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;gap:12px;background:rgba(0,0,0,0.2)">
                        <i data-lucide="fingerprint" style="color:var(--ac);width:16px"></i>
                        <span id="vfs-fn-sys" style="font-size:14px;font-weight:500;color:var(--txt)">No File
                            Selected</span>
                        <div style="flex:1"></div>
                        <button class="btn okc" style="padding:8px 14px;font-size:12px" onclick="ideSave('sys')"><i
                                data-lucide="save"></i> Save File</button>
                    </div>
                    <textarea id="vfs-ed-sys"
                        style="flex:1;resize:none;font-size:14px;font-family:var(--font-mono);line-height:1.6;padding:20px;border:none;border-radius:0;background:transparent;backdrop-filter:none;"
                        spellcheck="false"
                        placeholder="Select a core identity file... These files are immune to workspace formatting."></textarea>
                </div>
            </div>
        </div>

        <div id="p-mod" class="panel">
            <div style="max-width:1200px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:15px">
                <div class="card">
                    <div class="c-head"><i data-lucide="network"></i> The Multi-Model Router</div>
                    <p style="font-size:13px;color:var(--dim);line-height:1.5;margin-bottom:10px">Configure your model
                        matrix. The
                        internal Router will dynamically select the best active model per task. The first model is the
                        fallback.</p>
                    <div id="mod-list" style="display:flex;flex-direction:column;gap:12px"></div>
                    <button class="btn" style="margin-top:10px;align-self:flex-start" onclick="addModUI()"><i
                            data-lucide="plus"></i> Add New Model</button>
                </div>

                <div class="card">
                    <div class="c-head"><i data-lucide="settings-2"></i> Inference Params</div>
                    <div class="cfg-row"><span>Temperature</span><input type="range" id="c-tmp" min="0" max="2"
                            step="0.1" oninput="this.nextElementSibling.innerText=this.value;svGlb()"><span
                            style="color:var(--ac);font-weight:700"></span></div>
                </div>
            </div>
        </div>

        <!-- ── LOCAL AI (WebLLM) — Dedicated Tab ──────────────────────────── -->
        <div id="p-wllm" class="panel">
            <div style="max-width:1000px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:15px">
                <div class="card" style="border-color:rgba(0,255,204,0.2)">
                    <div class="c-head"
                        style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px">
                        <div style="display:flex;align-items:center;gap:10px">
                            <i data-lucide="cpu"></i>
                            Local AI — Model Library
                            <span
                                style="font-size:10px;padding:2px 8px;border-radius:20px;background:rgba(0,255,204,0.12);color:var(--ac);border:1px solid rgba(0,255,204,0.3);letter-spacing:1px;font-weight:700">WEBGPU</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:8px">
                            <span id="wllm-status"
                                style="display:inline-block;width:10px;height:10px;border-radius:50%;background:var(--dim);flex-shrink:0"></span>
                            <span id="wllm-status-label"
                                style="color:var(--dim);font-size:12px;font-weight:500">Idle</span>
                        </div>
                    </div>

                    <div id="wllm-gpu-warn"
                        style="display:none;margin-bottom:14px;padding:10px 14px;background:rgba(255,204,0,0.08);border:1px solid rgba(255,204,0,0.3);border-radius:8px;font-size:12.5px;color:var(--war);line-height:1.6">
                        <i data-lucide="alert-triangle"
                            style="width:14px;height:14px;display:inline-block;vertical-align:middle;margin-right:6px"></i>
                        <strong>WebGPU not detected.</strong> Use Chrome 113+, Edge 113+, or Safari 18+ with a
                        compatible GPU.
                    </div>

                    <p style="font-size:13px;color:var(--dim);line-height:1.6;margin-bottom:16px">Run open-source LLMs
                        entirely in your browser — <strong style="color:var(--txt)">no API key required</strong>. Models
                        are downloaded once and cached for instant reuse. Click <strong
                            style="color:var(--txt)">Download &amp; Load</strong> to activate a model; <strong
                            style="color:var(--txt)">Delete</strong> to remove it from your browser cache.</p>

                    <div id="wllm-progress-wrap" style="display:none;margin-bottom:16px">
                        <div style="display:flex;justify-content:space-between;margin-bottom:6px">
                            <span
                                style="font-size:11px;font-weight:600;color:var(--dim);letter-spacing:1px;text-transform:uppercase">Download
                                Progress</span>
                            <span id="wllm-progress-label" style="font-size:11px;color:var(--ac2)"></span>
                        </div>
                        <div style="height:6px;background:rgba(255,255,255,0.05);border-radius:10px;overflow:hidden">
                            <div id="wllm-progress-bar"
                                style="height:100%;width:0%;background:linear-gradient(90deg,var(--ac2),var(--ac));border-radius:10px;transition:width 0.25s ease">
                            </div>
                        </div>
                    </div>

                    <div id="wllm-library" style="display:flex;flex-direction:column;gap:8px"></div>

                    <p style="font-size:11.5px;color:var(--dim);margin-top:14px;line-height:1.5">
                        <i data-lucide="info"
                            style="width:12px;height:12px;display:inline;vertical-align:middle;margin-right:4px"></i>
                        Powered by <a href="https://webllm.mlc.ai" target="_blank"
                            style="color:var(--ac2);text-decoration:none">WebLLM</a> &amp; WebGPU. Models are stored in
                        your browser's Cache Storage.
                    </p>
                </div>
            </div>
        </div>

        <div id="p-term" class="panel" style="padding:0;background:transparent;">
            <div
                style="padding:16px 24px;display:flex;gap:24px;background:rgba(5,5,10,0.8);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.05);flex-wrap:wrap;z-index:10;box-shadow:0 4px 15px rgba(0,0,0,0.3)">
                <div style="font-size:11px;color:var(--dim);letter-spacing:1px;font-weight:600;"><span
                        style="color:var(--txt);font-weight:700" id="m-up">0s</span> UPTIME</div>
                <div style="font-size:11px;color:var(--dim);letter-spacing:1px;font-weight:600;"><span
                        style="color:var(--ac);font-weight:700" id="m-tk">0</span> TOKENS</div>
                <div style="font-size:11px;color:var(--dim);letter-spacing:1px;font-weight:600;"><span
                        style="color:var(--ac2);font-weight:700" id="m-ts">0</span> TASKS</div>
                <div style="flex:1"></div>
                <button class="btn err" style="padding:6px 12px;font-size:11px" onclick="clearTerm()"><i
                        data-lucide="trash"></i> Clear Log</button>
            </div>
            <div style="flex:1;overflow:hidden;display:flex;flex-direction:column;padding:20px">
                <div id="flowchart-container" class="flowchart" style="display:none"></div>
                <div class="log-wrap" id="t-log"></div>
            </div>
            <div
                style="border-top:1px solid rgba(255,255,255,0.05);background:var(--glass-bg);backdrop-filter:var(--glass-blur);padding:20px;display:flex;gap:12px;align-items:flex-end">
                <textarea id="t-in" rows="1" placeholder="Issue a superuser sys-command... (Use /workspace/ paths)"
                    style="font-size:14px;padding:14px 16px;border-radius:10px"></textarea>
                <button class="btn primary" id="btn-run-t"
                    style="height:52px;width:56px;flex-shrink:0;padding:0;border-radius:10px"><i
                        data-lucide="terminal-square"></i></button>
            </div>
        </div>

        <div id="p-cfg" class="panel">
            <div style="max-width:800px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:15px">
                <div class="card">
                    <div class="c-head"><i data-lucide="send"></i> Telegram Webhooks</div>
                    <p style="font-size:13px;color:var(--dim);line-height:1.5;margin-bottom:10px">Enter your BotFather
                        token below. The AI will auto-register every user who messages the bot and can dispatch messages
                        cross-user autonomously.</p>
                    <div style="display:flex;gap:10px;flex-wrap:wrap">
                        <input type="password" id="c-tg" placeholder="Bot Token" style="flex:1;min-width:200px"
                            oninput="svGlb()">
                        <button class="btn okc" id="btn-tst-tg" onclick="tstTg()"><i data-lucide="plug"></i> Test
                            Connection</button>
                    </div>
                    <div
                        style="display:flex;align-items:center;justify-content:space-between;background:var(--bg);padding:16px;border-radius:6px;border:1px solid var(--bd);margin-top:15px">
                        <div>
                            <div style="font-weight:600;font-size:15px;color:var(--txt)">24/7 Autonomous Polling</div>
                            <div style="font-size:12.5px;color:var(--dim);margin-top:2px">If ON, tasks execute from
                                Telegram endlessly in the background.</div>
                        </div>
                        <label class="switch tg-sw"><input type="checkbox" id="c-auto" onchange="tgTog()"><span
                                class="slider"></span></label>
                    </div>
                </div>

                <!-- Known Telegram Users Directory -->
                <div class="card">
                    <div class="c-head"><i data-lucide="users"></i> Known Telegram Users</div>
                    <p style="font-size:13px;color:var(--dim);line-height:1.5;margin-bottom:12px">Every user who
                        messages your bot is auto-registered here. The AI can send messages to any of these users
                        autonomously when instructed. You can also dispatch a quick manual message.</p>
                    <div id="tg-users-list">
                        <div style="font-size:12px;color:var(--dim);padding:10px 0">No users yet. Users are
                            auto-registered when they message the bot.</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="toast-container" class="toast-container"></div>
    <script src="js/core/state.js" defer></script>
    <script src="js/core/vfs.js" defer></script>
    <script src="js/core/webllm.js" defer></script>
    <script src="js/core/memory.js" defer></script>
    <script src="js/core/ai.js" defer></script>
    <script src="js/core/telegram.js" defer></script>
    <script src="js/ui/app.js" defer></script>
    <script src="js/global.js" defer></script>
</body>

</html>